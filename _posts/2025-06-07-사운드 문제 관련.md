---
title: "삼성 갤럭시북 5 프로 우분투 설치 시 사운드 관련 문제 해결기"
layout: page
---

---
title: "Galaxy Book 5 pro 우분투 내장 스피커 해결기"
layout: page
---

이 글은 갤럭시북에서 스피커가 안나오는 문제에 대한 해결 방법에 관한글이 아니라 현재 해결 방안을 연구중인 프로젝트입니다.
혹시라도 해결 방법에 관한 것인지 알고 왔다면 빨리 여기서 시간낭비하지 말고 나가시길 바랍니다.

필자는 현재 학업과 개발용 노트북으로 갤북 5프로를 사용중입니다. 하지만 점점 개발 빈도가 늘어나 이 노트북에 ubuntu를 듀얼부팅으로 설치했지만 스피커가 안나와 여간 답답한게 아니었습니다.

![image](https://github.com/user-attachments/assets/ead382e6-5b31-427c-b303-763925951366)

그러던 중 깃허브에서 여러 굇수 아조씨들의 레포를 발견하게되었습니다.

[repo 1](https://github.com/joshuagrisham/galaxy-book2-pro-linux)
[repo 2](https://github.com/dgunay/galaxy-book4-pro-reverse-engineering)

첫번째 글은 갤럭시 북2 프로에서 작동하지만 제 노트북에서는 작동하지 않았습니다. 또한 두번째 글은 실패했다고 하더라고요.

두가지 레포의 공통점은 qemu로 윈도우 인스턴스를 만든 후 오디오 드라이버를 설치하고 윈도우에서 어떤 작동을 하는지 덤프파일을 만드는 것이었습니다.

또한 [이 깃허브 이슈](https://github.com/thesofproject/linux/issues/4055)도 참고했습니다. 여기서는 verb를 덤프하는 법을 알려줍니다.


(덤프 방법 캡처사진)

스크립트를 만들어야 하는데 스크립트는 다음과 같이 생겼습니다.
bash
echo "Init front left speaker (0x38)"

hda-verb /dev/snd/hwC0D0 0x20 0x500 0x22
hda-verb /dev/snd/hwC0D0 0x20 0x400 0x38

hda-verb /dev/snd/hwC0D0 0x20 0x500 0x23
hda-verb /dev/snd/hwC0D0 0x20 0x420 0x00
hda-verb /dev/snd/hwC0D0 0x20 0x400 0x00
hda-verb /dev/snd/hwC0D0 0x20 0x400 0x01
hda-verb /dev/snd/hwC0D0 0x20 0x4B0 0x11
저 스크립트는 왼쪽스피커를 초기화 하는 부분같네요. 
이 스크립트는 **hda-verb**라는 유틸리티를 사용해서 ALSA 하드웨어 레벨에서 직접 오디오 코덱(즉, 사운드 칩셋)을 제어하는 것 입니다.노드의 "verb"(명령어) 를 수동으로 보낼 수 있게 해줍니다.
위 스크립트는 갤럭시 북 2 프로에서 작동해서 제 노트북에서는 작동하지는 않지만 제 노트북에서도 저것과 비슷하게 작동할 것 같습니다.

또한 저 스크립트를 분석해 본 결과 다음 과정들이 순서대로 진행되는 것 같습니다.
* "Init front left speaker (0x38)"
* Disable the speaker
* Init
* "Init front right speaker (0x39)"
*  Disable the speaker
* Init
* "Init back left speaker (0x3C)"
* Disable the speaker
* Init
* "Init back right speaker (0x3D)"
* Disable the speaker
* Init
* "Enable front left speaker (0x38)"
* "Enable front right speaker (0x38)"
*  "Enable back left speaker (0x3C)"
* "Enable back right speaker (0x3D)"

## 해결 과정
먼저 계획을 세웠고 다음과 같은 과정으로 해보기로 했습니다.
1. 듀얼 부팅으로 윈도우 쪽으로 가서 사운드 드라이버들을 모두 다운 받은 후 드라이브에 올리기
2. 내 우분투 os에 qemu로 윈도우 iso를 다운 받은 후 , qemu로 윈도우 iso 부팅이미지 생성
3. 그 후 qemu로 윈도우를 켠 후 그 윈도우 안에서 1에서 올려 둔 드라이버 다운로드 후 설치
4. 우분투 qemu에서 윈도우 돌릴 때 우분투를 걸쳐 소리가 나는게 아닌 직접 패스스루 방식으로 사운드 카드를 건드리게  설정
5. 그 후 qemu에서 소리 재생하면 드라이버도 설치되었고 패스스루 방식이니 정상적으로 스피커에서 소리가 날 것 그후 나는 소리들의 노드들을 추적해서 어떤 노드에 어떤 명령을 내리는지 추적
6. 5에서 한 작업 똑같이 본떠 리눅스에서도 똑같이 실행 후 소리 나는지 확인
1~6이 정상적으로 되었다면 이제 리눅스에서도 소리가 날것

# 2025.06.07일
QemuHDADump 라는 유용한 툴을 발견했습니다. 이 툴에 나오는 방법대로 먼저 해보았습니다.
## vfio 지원확인
제 프로세서가 vfio를 지원하는지 확인했습니다. 노트북을 보니 제 노트북은 Intel(R) Core(TM) Ultra 7 258V 를 사용하기 떄문에 인텔 홈페이지를 들어가 확인해보았습니다.

![image](https://github.com/user-attachments/assets/0381e586-010f-42dc-b237-96c2daff56de)

위와같이 지원하는 것을 볼 수 있습니다.

## 사운드 카드에 VFIO 설정
이제 사운드 카드에 VFIO 설정을 해야합니다. 이렇게 하면 제 호스트에서는 사운드카드를 사용하지 못하고 qemu에 사운드 카드를 넘겨주는 것입니다.
사운드 카드의 슬롯 번호와 PCI-ID를 얻어야 합니다. 이는 lspci -nn을 실행하면 얻을 수 있습니다

![image](https://github.com/user-attachments/assets/0e6b015a-43b9-4e07-8ed0-f0369efc094f)


00:1f.3 Multimedia audio controller [0401]: Intel Corporation Lunar Lake-M HD Audio Controller [8086:a828] (rev 10)
위 줄을 보면 제 사운드카드의 슬롯 번호는 00:1f.3이네요! 또한 [8086:a828] 이것도 보입니다. 기억해둡시다.
